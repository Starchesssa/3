
name: Video Background Removal (CLI Only)

on:
  workflow_dispatch:
  push:
    paths:
      - "MANIM/Vid_sample/*.mp4"

jobs:
  remove-bg:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v4

    - name: Install system dependencies
      run: |
        sudo apt update
        sudo apt install -y ffmpeg

    - name: Install Python tools (CPU only)
      run: |
        pip install torch torchvision --index-url https://download.pytorch.org/whl/cpu
        pip install backgroundremover

    - name: Create output folder
      run: |
        mkdir -p MANIM/Vid_sample/output

    - name: Remove background from all MP4s
      run: |
        for video in MANIM/Vid_sample/*.mp4; do
          name=$(basename "$video" .mp4)
          echo "Processing $video"
          backgroundremover \
            -i "$video" \
            -tv \
            -o "MANIM/Vid_sample/output/${name}_nobg.mov"
        done

    - name: Upload results
      uses: actions/upload-artifact@v4
      with:
        name: bg_removed_videos
        path: MANIM/Vid_sample/output
